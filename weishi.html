<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>微视明星榜</title>
  <script src="./echarts.min.js"></script>
</head>
<body>
  <div id="main" style="max-width: 100%;height:400px;"></div>
  <script type="text/javascript">
    var chartData = {
      time: [],
      data: {}
    };

    const idList = ['1533094129590089', '1523531129987967', '1518171062093059', '1531013105741172', '1523531013831494', '1532488530256054', '1527675032405982', '1535102593254289'];
    fetch('data/weishi.json', {
      credentials: 'include',
      headers: {
        'Content-Type': 'application/json'
      }})
      .then(res => {
        if (res.ok) {
          return res.json();
        } else {
          throw new Error('I cannot get the response');
        }
      })
      .then(data => {
        data.forEach(obj => {
          chartData.time.push(obj.time);
          obj.data.forEach(o => {
              const item = {
                  dbNum: o.dbNum,
                  name: o.name
              };
            if (idList.indexOf(o.id) > -1) {
                if (chartData.data[o.id]) {
                    chartData.data[o.id].push(item);
                } else {
                    chartData.data[o.id] = [item];
                }
            }
          })});
          setEchart();
      });

    function setEchart() {
      const id = Object.keys(chartData.data);
      const series = id.map(d => {
          var eDbNum = [];
          for (var i in chartData.data[d]) {
              eDbNum.push(chartData.data[d][i].dbNum);
          }
        return {
          name: chartData.data[d][0].name,
          type: 'line',
          data: eDbNum
        }
      });
      option = {
        title: {
          text: '微视明星榜（总榜）'
        },
        tooltip: {
          trigger: 'axis'
        },
        legend: {
          data: name
        },
        grid: {
          left: '3%',
          right: '4%',
          bottom: '3%',
          containLabel: true
        },
        xAxis: {
          type: 'category',
          boundaryGap: false,
          data: chartData.time
        },
        yAxis: {
          type: 'value'
        },
        series: series
    };
      var myChart = echarts.init(document.getElementById('main'));
      myChart.setOption(option);
    }
  </script>
</body>
</html>